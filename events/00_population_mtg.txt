add_namespace = population

news_event = {
	id = population.0
	picture = GFX_report_event_election_vote
	
	is_triggered_only = yes

    hidden = yes

	immediate = {

    set_variable = {
        var = global.global_pop
        value = 0
    }

    set_variable = {
        var = global.global_industrial_pop
        value = 0
    }

    set_variable = {
        var = global.global_agrarian_pop
        value = 0
    }

        every_country = {

        	set_variable = {
        		var = total_population
        		value = 0
        	}

            every_owned_state = {
                #Get the state's population
                set_variable = {
                    var = var_state_population
                    value = state_population
                }

            # Fix the often inevitable overflow.
            # First pass the parameters to the fixer function
            set_variable ={
	      		var = parameter_ORIGINAL_VAR
	   			value = var_state_population
            }

            repair_overflow = yes

            # And apply the result to the state population variable

            set_variable = {
            	var = var_state_population
            	value = CLEARME_return_REPAIRED_VAR
            }

            clear_variable = CLEARME_return_REPAIRED_VAR

            #When doing big calculations, country pops need to be downsized to avoid overflows. Taking off 3 digits should do the job.
            set_variable = {
                var = big_calcs_country_pop
                value = total_population
            }

            multiply_variable = { big_calcs_country_pop = 0.001 }

            add_to_variable = {
                var = global.global_pop
                value = big_calcs_country_pop
            }

            if = {
                limit = {
                    NOT = {
                        has_idea = pre_industrial_era
                    }
                }
                add_to_variable = {
                    var = global.global_industrial_pop
                    value = big_calcs_country_pop
                }
            }

            if = {
                limit = {
                    has_idea = pre_industrial_era
                }
                add_to_variable = {
                    var = global.global_agrarian_pop
                    value = big_calcs_country_pop
                }
            }
        }
	}
}